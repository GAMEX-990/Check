"use client"; // р╕Ър╕нр╕Бр╣Гр╕лр╣Й Next.js р╕гр╕╣р╣Йр╕зр╣Ир╕▓р╕Щр╕╡р╣Ир╣Ар╕Ыр╣Зр╕Щ Client Component


// р╕Щр╕│р╣Ар╕Вр╣Йр╕▓ React Hooks р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Ир╕▒р╕Фр╕Бр╕▓р╕г state р╣Бр╕ер╕░ lifecycle
import { useState, useEffect, useRef, ChangeEvent } from "react";

// р╕Щр╕│р╣Ар╕Вр╣Йр╕▓р╕Бр╕▓р╕гр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕е Firebase
import { db } from "@/lib/firebase";

// р╕Щр╕│р╣Ар╕Вр╣Йр╕▓р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕Хр╣Ир╕▓р╕Зр╣Ж р╕Ир╕▓р╕Б Firestore р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕гр╕Бр╕▒р╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕е
import { collection, addDoc, Timestamp, updateDoc, arrayUnion, doc, getDoc } from "firebase/firestore";

// р╕Щр╕│р╣Ар╕Вр╣Йр╕▓ Component р╕кр╕│р╕лр╕гр╕▒р╕Ър╣Бр╕кр╕Фр╕Зр╕гр╕╣р╕Ыр╕ар╕▓р╕Юр╕Ир╕▓р╕Б Next.js
import Image from "next/image";

// р╕Щр╕│р╣Ар╕Вр╣Йр╕▓ Hook р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╕Ир╕▓р╕Б Clerk Authentication
import { useUser } from "@clerk/nextjs";

// р╕Щр╕│р╣Ар╕Вр╣Йр╕▓р╣Др╕нр╕Др╕нр╕Щр╕Ыр╕┤р╕Фр╕Ир╕▓р╕Б React Icons
import { FaTimes } from "react-icons/fa";

// р╕Щр╕│р╣Ар╕Вр╣Йр╕▓р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕Хр╣Ир╕▓р╕Зр╣Ж р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Бр╕ер╣Йр╕нр╕Зр╣Бр╕ер╕░р╕кр╣Бр╕Бр╕Щ QR Code
import { openCamera, scanQRCode, stopCamera } from "@/utils/camera";



// р╕Бр╕│р╕лр╕Щр╕Ф Interface р╕кр╕│р╕лр╕гр╕▒р╕Ъ Props р╕Вр╕нр╕З Component
interface AddClassPopupProps {
  onScanSuccess?: () => void; // р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕Чр╕╡р╣Ир╕Ир╕░р╣Ар╕гр╕╡р╕вр╕Бр╣Ар╕бр╕╖р╣Ир╕нр╕кр╣Бр╕Бр╕Щ QR Code р╕кр╕│р╣Ар╕гр╣Зр╕И (optional)
}

// р╕кр╕гр╣Йр╕▓р╕З Functional Component р╕Кр╕╖р╣Ир╕н AddClassPopup
const AddClassPopup: React.FC<AddClassPopupProps> = ({ onScanSuccess }) => {
  // State variables р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕кр╕Цр╕▓р╕Щр╕░р╕Хр╣Ир╕▓р╕Зр╣Ж
  //------------------------------------------------------------------------------------------------
  // р╕кр╕гр╣Йр╕▓р╕З Reference р╕кр╕│р╕лр╕гр╕▒р╕Ъ Canvas element р╕Чр╕╡р╣Ир╣Гр╕Кр╣Йр╣Гр╕Щр╕Бр╕▓р╕гр╣Бр╕кр╕Фр╕Зр╕Ьр╕ер╕Бр╕▓р╕гр╕кр╣Бр╕Бр╕Щ QR Code
  const canvasRef = useRef<HTMLCanvasElement>(null);


  //------------------------------------------------------------------------------------------------

  // р╕кр╕гр╣Йр╕▓р╕З Reference р╕кр╕│р╕лр╕гр╕▒р╕Ъ Video element р╕Чр╕╡р╣Ир╣Гр╕Кр╣Йр╣Бр╕кр╕Фр╕Зр╕ар╕▓р╕Юр╕Ир╕▓р╕Бр╕Бр╕ер╣Йр╕нр╕З
  const videoRef = useRef<HTMLVideoElement>(null);

  // State р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Др╕зр╕Ър╕Др╕╕р╕бр╕кр╕Цр╕▓р╕Щр╕░р╕Бр╕▓р╕гр╕кр╣Бр╕Бр╕Щ QR Code (р╣Ар╕Ыр╕┤р╕Ф/р╕Ыр╕┤р╕Ф)
  const [scanning, setScanning] = useState(false);

  // State р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Др╕зр╕Ър╕Др╕╕р╕бр╕Бр╕▓р╕гр╣Бр╕кр╕Фр╕З popup р╕кр╕гр╣Йр╕▓р╕Зр╕Др╕ер╕▓р╕к (р╣Ар╕Ыр╕┤р╕Ф/р╕Ыр╕┤р╕Ф)
  const [showPopup, setShowPopup] = useState(false);

  // State р╕кр╕│р╕лр╕гр╕▒р╕Ър╣Ар╕Бр╣Зр╕Ър╕Кр╕╖р╣Ир╕нр╕Др╕ер╕▓р╕кр╕Чр╕╡р╣Ир╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╕Бр╕гр╕нр╕Б
  const [className, setClassName] = useState("");

  // State р╕кр╕│р╕лр╕гр╕▒р╕Ър╣Бр╕кр╕Фр╕Зр╕кр╕Цр╕▓р╕Щр╕░р╕Бр╕▓р╕гр╣Вр╕лр╕ер╕Ф (р╕Бр╕│р╕ер╕▒р╕Зр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г/р╣Ар╕кр╕гр╣Зр╕Ир╕кр╕┤р╣Йр╕Щ)
  const [loading, setLoading] = useState(false);

  // State р╕кр╕│р╕лр╕гр╕▒р╕Ър╣Ар╕Бр╣Зр╕Ър╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Бр╕кр╕Фр╕Зр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Ф
  const [error, setError] = useState<string | null>(null);

  // State р╕кр╕│р╕лр╕гр╕▒р╕Ър╣Ар╕Бр╣Зр╕Ъ ID р╕Вр╕нр╕Зр╕Др╕ер╕▓р╕кр╕Чр╕╡р╣Ир╕кр╕гр╣Йр╕▓р╕Зр╕Вр╕╢р╣Йр╕Щ
  const [classId, setClassId] = useState<string | null>(null);

  // р╕Фр╕╢р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╣Бр╕ер╕░р╕кр╕Цр╕▓р╕Щр╕░р╕Бр╕▓р╕гр╕ер╣Зр╕нр╕Бр╕нр╕┤р╕Щр╕Ир╕▓р╕Б Clerk
  const { user, isSignedIn } = useUser();

  // р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╣Ар╕бр╕╖р╣Ир╕нр╕кр╣Бр╕Бр╕Щ QR Code р╕кр╕│р╣Ар╕гр╣Зр╕И
  const handleQRDetected = async (result: { data: string }) => {



    try {

      // р╕Ыр╕┤р╕Фр╕Бр╕ер╣Йр╕нр╕Зр╕Чр╕▒р╕Щр╕Чр╕╡р╣Ар╕бр╕╖р╣Ир╕нр╕кр╣Бр╕Бр╕Щр╣Ар╕кр╕гр╣Зр╕И
      if (videoRef.current?.srcObject) {
        const stream = videoRef.current.srcObject as MediaStream;
        stopCamera(stream);
        videoRef.current.srcObject = null;
      }

      // р╕Ыр╕┤р╕Фр╕кр╕Цр╕▓р╕Щр╕░р╕Бр╕▓р╕гр╕кр╣Бр╕Бр╕Щ
      setScanning(false);

      // р╣Бр╕Ыр╕ер╕З QR Code р╕Чр╕╡р╣Ир╕кр╣Бр╕Бр╕Щр╣Др╕Фр╣Йр╣Ар╕Ыр╣Зр╕Щ URL object
      const url = new URL(result.data);

      // р╕Фр╕╢р╕З Class ID р╕Ир╕▓р╕Бр╕кр╣Ир╕зр╕Щр╕Чр╣Йр╕▓р╕вр╕Вр╕нр╕З URL path
      const classId = url.pathname.split('/').pop();

      // р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕бр╕╡ Class ID р╣Бр╕ер╕░р╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╕ер╣Зр╕нр╕Бр╕нр╕┤р╕Щр╣Бр╕ер╣Йр╕зр╕лр╕гр╕╖р╕нр╣Др╕бр╣И
      if (!classId || !user) {
        alert('р╣Др╕бр╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Ар╕Кр╣Зр╕Др╕Кр╕╖р╣Ир╕нр╣Др╕Фр╣Й р╕Бр╕гр╕╕р╕Ур╕▓р╕ер╕нр╕Зр╣Гр╕лр╕бр╣И'); // р╣Бр╕кр╕Фр╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Ар╕Хр╕╖р╕нр╕Щ
        return; // р╕лр╕вр╕╕р╕Фр╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щ
      }

      // р╣Ар╕гр╕┤р╣Ир╕бр╕кр╕Цр╕▓р╕Щр╕░р╕Бр╕▓р╕гр╣Вр╕лр╕ер╕Ф
      setLoading(true);

      // р╕кр╕гр╣Йр╕▓р╕З Reference р╣Др╕Ыр╕вр╕▒р╕Зр╣Ар╕нр╕Бр╕кр╕▓р╕гр╕Др╕ер╕▓р╕кр╣Гр╕Щ Firestore
      const classRef = doc(db, "classes", classId);

      // р╕Фр╕╢р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Др╕ер╕▓р╕кр╕Ир╕▓р╕Б Firestore
      const classDoc = await getDoc(classRef);

      // р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕Др╕ер╕▓р╕кр╕бр╕╡р╕нр╕вр╕╣р╣Ир╕Ир╕гр╕┤р╕Зр╕лр╕гр╕╖р╕нр╣Др╕бр╣И
      if (classDoc.exists()) {
        // р╕Фр╕╢р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Вр╕нр╕Зр╕Др╕ер╕▓р╕к
        const classData = classDoc.data();

        // р╕Фр╕╢р╕Зр╕гр╕▓р╕вр╕Кр╕╖р╣Ир╕нр╕кр╕бр╕▓р╕Кр╕┤р╕Бр╕Чр╕╡р╣Ир╣Ар╕Кр╣Зр╕Др╕Кр╕╖р╣Ир╕нр╣Бр╕ер╣Йр╕з (р╕лр╕▓р╕Бр╣Др╕бр╣Ир╕бр╕╡р╣Гр╕лр╣Йр╣Ар╕Ыр╣Зр╕Щ array р╕зр╣Ир╕▓р╕З)
        const checkedInMembers = classData.checkedInMembers || [];

        // р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╣Ар╕Кр╣Зр╕Др╕Кр╕╖р╣Ир╕нр╣Др╕Ыр╣Бр╕ер╣Йр╕зр╕лр╕гр╕╖р╕нр╕вр╕▒р╕З
        if (checkedInMembers.includes(user.id)) {
          alert('р╕Др╕╕р╕Ур╣Др╕Фр╣Йр╣Ар╕Кр╣Зр╕Др╕Кр╕╖р╣Ир╕нр╣Др╕Ыр╣Бр╕ер╣Йр╕з!'); // р╣Бр╕кр╕Фр╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щ
          return; // р╕лр╕вр╕╕р╕Фр╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щ
        }

        // р╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Др╕ер╕▓р╕кр╣Гр╕Щр╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕е
        await updateDoc(classRef, {
          // р╣Ар╕Юр╕┤р╣Ир╕б ID р╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╣Ар╕Вр╣Йр╕▓р╣Др╕Ыр╣Гр╕Щр╕гр╕▓р╕вр╕Кр╕╖р╣Ир╕нр╕Чр╕╡р╣Ир╣Ар╕Кр╣Зр╕Др╕Кр╕╖р╣Ир╕нр╣Бр╕ер╣Йр╕з
          checkedInMembers: arrayUnion(user.id),
          // р╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕Ир╕│р╕Щр╕зр╕Щр╕Др╕Щр╕Чр╕╡р╣Ир╣Ар╕Кр╣Зр╕Др╕Кр╕╖р╣Ир╕нр╣Бр╕ер╣Йр╕з
          checkedInCount: checkedInMembers.length + 1,
          // р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╣Ар╕зр╕ер╕▓р╕Чр╕╡р╣Ир╣Ар╕Кр╣Зр╕Др╕Кр╕╖р╣Ир╕нр╕ер╣Ир╕▓р╕кр╕╕р╕Ф
          lastCheckedIn: Timestamp.now()
        });
        alert('р╣Ар╕Кр╣Зр╕Др╕Кр╕╖р╣Ир╕нр╕кр╕│р╣Ар╕гр╣Зр╕И!'); // р╣Бр╕кр╕Фр╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Бр╕Ир╣Йр╕Зр╕Др╕зр╕▓р╕бр╕кр╕│р╣Ар╕гр╣Зр╕И
        onScanSuccess?.(); // р╣Ар╕гр╕╡р╕вр╕Бр╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щ callback (р╕лр╕▓р╕Бр╕бр╕╡) р╣Ар╕бр╕╖р╣Ир╕нр╕кр╣Бр╕Бр╕Щр╕кр╕│р╣Ар╕гр╣Зр╕И
      }
    } catch (error) {
      // р╕Ир╕▒р╕Ър╣Бр╕ер╕░р╣Бр╕кр╕Фр╕З error р╕лр╕▓р╕Бр╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Ф
      console.error('Error:', error);
      alert('р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╣Ар╕Кр╣Зр╕Др╕Кр╕╖р╣Ир╕н');
    } finally {
      // р╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕гр╣Гр╕Щр╕кр╣Ир╕зр╕Щ finally (р╣Др╕бр╣Ир╕зр╣Ир╕▓р╕Ир╕░р╕кр╕│р╣Ар╕гр╣Зр╕Ир╕лр╕гр╕╖р╕нр╣Др╕бр╣И)
      setLoading(false); // р╕лр╕вр╕╕р╕Фр╕кр╕Цр╕▓р╕Щр╕░р╕Бр╕▓р╕гр╣Вр╕лр╕ер╕Ф
    }
  };

  // useEffect Hook р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Бр╕▓р╕гр╣Ар╕Ыр╕┤р╕Ф/р╕Ыр╕┤р╕Фр╕Бр╕ер╣Йр╕нр╕Зр╣Бр╕ер╕░р╕Бр╕▓р╕гр╕кр╣Бр╕Бр╕Щ QR Code
  useEffect(() => {
    // р╕Хр╕▒р╕зр╣Бр╕Ыр╕гр╕кр╕│р╕лр╕гр╕▒р╕Ър╣Ар╕Бр╣Зр╕Ъ Media Stream р╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щ
    let currentStream: MediaStream | null = null;

    // р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕нр╕вр╕╣р╣Ир╣Гр╕Щр╕кр╕Цр╕▓р╕Щр╕░р╕Бр╕▓р╕гр╕кр╣Бр╕Бр╕Щр╣Бр╕ер╕░р╕бр╕╡ video, canvas elements
    if (scanning && videoRef.current && canvasRef.current) {
      // р╣Ар╕Ыр╕┤р╕Фр╕Бр╕ер╣Йр╕нр╕Зр╣Бр╕ер╕░р╣Ар╕гр╕┤р╣Ир╕бр╕Бр╕▓р╕гр╕кр╣Бр╕Бр╕Щ
      openCamera(videoRef.current).then((stream) => {
        // р╣Ар╕гр╕┤р╣Ир╕бр╕Бр╕▓р╕гр╕кр╣Бр╕Бр╕Щ QR Code р╣Вр╕Фр╕вр╕кр╣Ир╕З elements р╣Бр╕ер╕░ callback functions
        const scanner = scanQRCode(
          videoRef.current!, // Video element (! р╕лр╕бр╕▓р╕вр╕Цр╕╢р╕Зр╕бр╕▒р╣Ир╕Щр╣Гр╕Ир╕зр╣Ир╕▓р╣Др╕бр╣Ир╣Ар╕Ыр╣Зр╕Щ null)
          canvasRef.current!, // Canvas element
          handleQRDetected, // р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕Чр╕╡р╣Ир╕Ир╕░р╣Ар╕гр╕╡р╕вр╕Бр╣Ар╕бр╕╖р╣Ир╕нр╕кр╣Бр╕Бр╕Щр╕кр╕│р╣Ар╕гр╣Зр╕И
          (error: any) => { // р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕Чр╕╡р╣Ир╕Ир╕░р╣Ар╕гр╕╡р╕вр╕Бр╣Ар╕бр╕╖р╣Ир╕нр╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Ф
            console.error("р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕кр╣Бр╕Бр╕Щ:", error);
            alert(error);
          }
        );

        // р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щ Cleanup р╣Ар╕бр╕╖р╣Ир╕нр╕Ыр╕┤р╕Фр╕Бр╕▓р╕гр╕кр╣Бр╕Бр╕Щ
        return () => {
          // р╕лр╕вр╕╕р╕Фр╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щр╕Вр╕нр╕З scanner р╕лр╕▓р╕Бр╕бр╕╡
          if (scanner) {
            scanner.stop();
          }
          // р╕лр╕вр╕╕р╕Фр╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щр╕Вр╕нр╕Зр╕Бр╕ер╣Йр╕нр╕Зр╕лр╕▓р╕Бр╕бр╕╡ stream
          if (currentStream) {
            stopCamera(currentStream);
            currentStream = null;
          }
        };
      }).catch((error) => {
        // р╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╕Бр╕▓р╕гр╣Ар╕Ыр╕┤р╕Фр╕Бр╕ер╣Йр╕нр╕З
        console.error("р╣Др╕бр╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Ар╕Ыр╕┤р╕Фр╕Бр╕ер╣Йр╕нр╕Зр╣Др╕Фр╣Й:", error);
        alert("р╣Др╕бр╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Ар╕Ыр╕┤р╕Фр╕Бр╕ер╣Йр╕нр╕Зр╣Др╕Фр╣Й р╕Бр╕гр╕╕р╕Ур╕▓р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Бр╕▓р╕гр╕нр╕Щр╕╕р╕Нр╕▓р╕Хр╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╕Бр╕ер╣Йр╕нр╕З");
        setScanning(false); // р╕Ыр╕┤р╕Фр╕кр╕Цр╕▓р╕Щр╕░р╕Бр╕▓р╕гр╕кр╣Бр╕Бр╕Щ
      });

      // р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щ Cleanup р╕Вр╕нр╕З useEffect
      return () => {
        // р╕лр╕вр╕╕р╕Фр╕Бр╕ер╣Йр╕нр╕Зр╕лр╕▓р╕Бр╕бр╕╡ stream р╕Чр╕│р╕Зр╕▓р╕Щр╕нр╕вр╕╣р╣И
        if (currentStream) {
          stopCamera(currentStream);
          currentStream = null;
        }
      };
    }
  }, [scanning]); // dependency array - useEffect р╕Ир╕░р╕Чр╕│р╕Зр╕▓р╕Щр╣Ар╕бр╕╖р╣Ир╕н scanning state р╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щ

  // р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕гр╣Йр╕▓р╕Зр╕Др╕ер╕▓р╕кр╣Гр╕лр╕бр╣И
  const handleCreateClass = async () => {
    // р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╕Бр╕гр╕нр╕Бр╕Кр╕╖р╣Ир╕нр╕Др╕ер╕▓р╕кр╕лр╕гр╕╖р╕нр╣Др╕бр╣И (trim() р╣Ар╕Юр╕╖р╣Ир╕нр╕ер╕Ър╕Кр╣Ир╕нр╕Зр╕зр╣Ир╕▓р╕Зр╕лр╕Щр╣Йр╕▓-р╕лр╕ер╕▒р╕З)
    if (!className.trim()) {
      setError("р╕Бр╕гр╕╕р╕Ур╕▓р╕Бр╕гр╕нр╕Бр╕Кр╕╖р╣Ир╕нр╕Др╕ер╕▓р╕кр╕Бр╣Ир╕нр╕Щ"); // р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Ф
      return; // р╕лр╕вр╕╕р╕Фр╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щ
    }

    // р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╕ер╣Зр╕нр╕Бр╕нр╕┤р╕Щр╣Бр╕ер╣Йр╕зр╕лр╕гр╕╖р╕нр╣Др╕бр╣И
    if (!isSignedIn || !user) {
      setError("р╕Др╕╕р╕Ур╕вр╕▒р╕Зр╣Др╕бр╣Ир╣Др╕Фр╣Йр╕ер╣Зр╕нр╕Бр╕нр╕┤р╕Щ"); // р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Ф
      return; // р╕лр╕вр╕╕р╕Фр╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щ
    }

    try {
      setLoading(true); // р╣Ар╕гр╕┤р╣Ир╕бр╕кр╕Цр╕▓р╕Щр╕░р╕Бр╕▓р╕гр╣Вр╕лр╕ер╕Ф
      setError(null); // р╕ер╣Йр╕▓р╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╕Бр╣Ир╕нр╕Щр╕лр╕Щр╣Йр╕▓

      // р╕Фр╕╢р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й
      const userId = user.id; // ID р╕Вр╕нр╕Зр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й
      const userEmail = user.primaryEmailAddress?.emailAddress || ""; // р╕нр╕╡р╣Ар╕бр╕ер╕Вр╕нр╕Зр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й

      // р╕кр╕гр╣Йр╕▓р╕Зр╣Ар╕нр╕Бр╕кр╕▓р╕гр╕Др╕ер╕▓р╕кр╣Гр╕лр╕бр╣Ир╣Гр╕Щ Firestore collection "classes"
      const docRef = await addDoc(collection(db, "classes"), {
        name: className.trim(), // р╕Кр╕╖р╣Ир╕нр╕Др╕ер╕▓р╕к (р╕ер╕Ър╕Кр╣Ир╕нр╕Зр╕зр╣Ир╕▓р╕Зр╕лр╕Щр╣Йр╕▓-р╕лр╕ер╕▒р╕З)
        created_by: userId, // ID р╕Вр╕нр╕Зр╕Ьр╕╣р╣Йр╕кр╕гр╣Йр╕▓р╕Зр╕Др╕ер╕▓р╕к
        created_at: Timestamp.fromDate(new Date()), // р╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╣Бр╕ер╕░р╣Ар╕зр╕ер╕▓р╕Чр╕╡р╣Ир╕кр╕гр╣Йр╕▓р╕З
        members: [userId], // р╕гр╕▓р╕вр╕Кр╕╖р╣Ир╕нр╕кр╕бр╕▓р╕Кр╕┤р╕Бр╣Гр╕Щр╕Др╕ер╕▓р╕к (р╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щр╕Фр╣Йр╕зр╕вр╕Ьр╕╣р╣Йр╕кр╕гр╣Йр╕▓р╕З)
        memberCount: 1, // р╕Ир╕│р╕Щр╕зр╕Щр╕кр╕бр╕▓р╕Кр╕┤р╕Бр╣Гр╕Щр╕Др╕ер╕▓р╕к
        checkedInCount: 0,  // р╕Ир╕│р╕Щр╕зр╕Щр╕Др╕Щр╕Чр╕╡р╣Ир╣Ар╕Кр╣Зр╕Др╕Кр╕╖р╣Ир╕нр╣Бр╕ер╣Йр╕з (р╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щ 0)
        checkedInMembers: [], // р╕гр╕▓р╕вр╕Кр╕╖р╣Ир╕нр╕кр╕бр╕▓р╕Кр╕┤р╕Бр╕Чр╕╡р╣Ир╣Ар╕Кр╣Зр╕Др╕Кр╕╖р╣Ир╕нр╣Бр╕ер╣Йр╕з (р╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щр╕зр╣Ир╕▓р╕З)
        owner_email: userEmail, // р╕нр╕╡р╣Ар╕бр╕ер╕Вр╕нр╕Зр╣Ар╕Ир╣Йр╕▓р╕Вр╕нр╕Зр╕Др╕ер╕▓р╕к
        last_updated: Timestamp.fromDate(new Date()), // р╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╣Бр╕ер╕░р╣Ар╕зр╕ер╕▓р╕Чр╕╡р╣Ир╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╕ер╣Ир╕▓р╕кр╕╕р╕Ф
      });

      // setSuccess(true); // р╕Ър╕гр╕гр╕Чр╕▒р╕Фр╕Щр╕╡р╣Йр╕Цр╕╣р╕Б comment р╣Др╕зр╣Й - р╕нр╕▓р╕Ир╣Гр╕Кр╣Йр╕кр╕│р╕лр╕гр╕▒р╕Ър╣Бр╕кр╕Фр╕Зр╕кр╕Цр╕▓р╕Щр╕░р╕Др╕зр╕▓р╕бр╕кр╕│р╣Ар╕гр╣Зр╕И
      setClassName(""); // р╕ер╣Йр╕▓р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Кр╕╖р╣Ир╕нр╕Др╕ер╕▓р╕кр╣Гр╕Щ input field

    } catch (error) {
      // р╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕кр╕гр╣Йр╕▓р╕Зр╕Др╕ер╕▓р╕к
      console.error("Error details:", error);
      // р╣Бр╕кр╕Фр╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╕Чр╕╡р╣Ир╣Ар╕лр╕бр╕▓р╕░р╕кр╕б
      setError(`р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Ф: ${error instanceof Error ? error.message : 'Unknown error'}`);
    } finally {
      setLoading(false); // р╕Ир╕Ър╕кр╕Цр╕▓р╕Щр╕░р╕Бр╕▓р╕гр╣Вр╕лр╕ер╕Ф (р╕Чр╕│р╕Зр╕▓р╕Щр╣Др╕бр╣Ир╕зр╣Ир╕▓р╕Ир╕░р╕кр╕│р╣Ар╕гр╣Зр╕Ир╕лр╕гр╕╖р╕нр╣Др╕бр╣И)
    }
  };

  // р╕кр╣Ир╕зр╕Щр╕Щр╕╡р╣Йр╣Ар╕Ыр╣Зр╕Щ comment р╕Вр╕нр╕Зр╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕нр╕▒р╕Ыр╣Вр╕лр╕ер╕Ф CSV (р╕Цр╕╣р╕Б comment р╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф)
  // // р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕нр╕▒р╕Ыр╣Вр╕лр╕ер╕Фр╣Др╕Яр╕ер╣М CSV р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Щр╕▒р╕Бр╣Ар╕гр╕╡р╕вр╕Щ
  // const handleUploadCSV = async (event: ChangeEvent<HTMLInputElement>) => {
  //   const file = event.target.files?.[0];
  //   if (!file) return; // р╕Цр╣Йр╕▓р╣Др╕бр╣Ир╕бр╕╡р╣Др╕Яр╕ер╣Мр╣Гр╕лр╣Йр╕лр╕вр╕╕р╕Ф

  //   // р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕бр╕╡ classId р╕лр╕гр╕╖р╕нр╣Др╕бр╣И
  //   if (!classId) {
  //     alert("р╕Бр╕гр╕╕р╕Ур╕▓р╕кр╕гр╣Йр╕▓р╕Зр╕Др╕ер╕▓р╕кр╕Бр╣Ир╕нр╕Щр╕нр╕▒р╕Ыр╣Вр╕лр╕ер╕Фр╕Щр╕▒р╕Бр╣Ар╕гр╕╡р╕вр╕Щ");
  //     return;
  //   }

  //   const reader = new FileReader();
  //   reader.onload = async (e) => {
  //     const text = e.target?.result;
  //     if (typeof text !== "string") return;

  //     // р╣Бр╕вр╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Бр╕Хр╣Ир╕ер╕░р╕Ър╕гр╕гр╕Чр╕▒р╕Фр╣Гр╕Щ CSV
  //     const lines = text.split("\n");
  //     for (const line of lines) {
  //       const [name, studentId, major] = line.trim().split(",");

  //       // р╕Цр╣Йр╕▓р╕бр╕╡р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Др╕гр╕Ър╕Цр╣Йр╕зр╕Щр╣Гр╕лр╣Йр╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕ер╕З Firebase
  //       if (name && studentId && major) {
  //         await addDoc(collection(db, "students"), {
  //           name, // р╕Кр╕╖р╣Ир╕нр╕Щр╕▒р╕Бр╣Ар╕гр╕╡р╕вр╕Щ
  //           studentId, // р╕гр╕лр╕▒р╕кр╕Щр╕▒р╕Бр╣Ар╕гр╕╡р╕вр╕Щ
  //           major, // р╕кр╕▓р╕Вр╕▓р╕зр╕┤р╕Кр╕▓
  //           classId, // ID р╕Вр╕нр╕Зр╕Др╕ер╕▓р╕к
  //           createdAt: Timestamp.now(), // р╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╕кр╕гр╣Йр╕▓р╕З
  //         });
  //       }
  //     }
  //     alert("р╕нр╕▒р╕Ыр╣Вр╕лр╕ер╕Фр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Щр╕▒р╕Бр╣Ар╕гр╕╡р╕вр╕Щр╕кр╕│р╣Ар╕гр╣Зр╕И!");
  //   };

  //   reader.readAsText(file); // р╕нр╣Ир╕▓р╕Щр╣Др╕Яр╕ер╣Мр╣Ар╕Ыр╣Зр╕Щр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б
  // };

  // р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕Ыр╕┤р╕Ф popup р╕кр╕гр╣Йр╕▓р╕Зр╕Др╕ер╕▓р╕к
  const closePopup = () => {
    setShowPopup(false); // р╕Ыр╕┤р╕Ф popup
    setClassName(""); // р╕ер╣Йр╕▓р╕Зр╕Кр╕╖р╣Ир╕нр╕Др╕ер╕▓р╕к
    setError(null); // р╕ер╣Йр╕▓р╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Ф
    setScanning(false); // р╕Ыр╕┤р╕Фр╕Бр╕▓р╕гр╕кр╣Бр╕Бр╕Щ
    // setSuccess(false); // р╕Ър╕гр╕гр╕Чр╕▒р╕Фр╕Щр╕╡р╣Йр╕Цр╕╣р╕Б comment р╣Др╕зр╣Й - р╕нр╕▓р╕Ир╣Гр╕Кр╣Йр╕кр╕│р╕лр╕гр╕▒р╕Ър╕гр╕╡р╣Ар╕Лр╣Зр╕Хр╕кр╕Цр╕▓р╕Щр╕░р╕Др╕зр╕▓р╕бр╕кр╕│р╣Ар╕гр╣Зр╕И
  };

  // р╕кр╣Ир╕зр╕Щ JSX р╕Чр╕╡р╣Ир╕Ир╕░ render
  return (
    <div className=""> {/* Container р╕лр╕ер╕▒р╕Б */}
      {/* р╕кр╣Ир╕зр╕Щр╕Ыр╕╕р╣Ир╕бр╕Хр╣Ир╕▓р╕Зр╣Ж р╕Фр╣Йр╕▓р╕Щр╕Ър╕Щ */}
      <div className="h-0 md:flex md:flex-col md:-mx-34 md:-mt-15 max-md:mx-5 max-md:flex max-md:flex-row max-md:justify-center max-md:items-center max-md:gap-2 max-md:-mt-26 max-md:mb-26 max-md:h-0">
        {/* р╕Ыр╕╕р╣Ир╕бр╕кр╣Бр╕Бр╕Щ QR code */}
        <button
          className="w-20 h-auto border-purple-600 text-purple-600 py-1 rounded-2xl hover:bg-purple-100 md:mb-2 border md:ml-2" // CSS classes р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕Ир╕▒р╕Фр╣Бр╕Хр╣Ир╕Зр╕Ыр╕╕р╣Ир╕б
          onClick={() => setScanning(true)} // р╣Ар╕бр╕╖р╣Ир╕нр╕Др╕ер╕┤р╕Бр╣Гр╕лр╣Йр╣Ар╕гр╕┤р╣Ир╕бр╕Бр╕▓р╕гр╕кр╣Бр╕Бр╕Щ
        >
          Scan QR {/* р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Гр╕Щр╕Ыр╕╕р╣Ир╕б */}
        </button>

        {/* р╕Ыр╕╕р╣Ир╕бр╣Ар╕Юр╕┤р╣Ир╕бр╕Др╕ер╕▓р╕к */}
        <button
          className="w-25 h-auto border border-purple-600 text-purple-600 py-1 rounded-2xl hover:bg-purple-100 " // CSS classes р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕Ир╕▒р╕Фр╣Бр╕Хр╣Ир╕Зр╕Ыр╕╕р╣Ир╕б
          onClick={() => setShowPopup(true)} // р╣Ар╕бр╕╖р╣Ир╕нр╕Др╕ер╕┤р╕Бр╣Гр╕лр╣Йр╣Бр╕кр╕Фр╕З popup р╕кр╕гр╣Йр╕▓р╕Зр╕Др╕ер╕▓р╕к
        >
          Add a class {/* р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Гр╕Щр╕Ыр╕╕р╣Ир╕б */}
        </button>
      </div>

      {/* Popup р╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕гр╣Йр╕▓р╕Зр╕Др╕ер╕▓р╕кр╣Гр╕лр╕бр╣И - р╣Бр╕кр╕Фр╕Зр╣Ар╕бр╕╖р╣Ир╕н showPopup р╣Ар╕Ыр╣Зр╕Щ true */}
      {showPopup && (
        <div className="fixed inset-0 bg-[rgba(0,0,0,0.5)] flex items-center justify-center z-50"> {/* Overlay р╕Юр╕╖р╣Йр╕Щр╕лр╕ер╕▒р╕Зр╣Вр╕Ыр╕гр╣Ир╕Зр╣Гр╕к */}
          <div className="bg-white rounded-3xl shadow-lg p-6 relative max-w-2xl w-full  overflow-hidden"> {/* р╕Бр╕ер╣Ир╕нр╕З popup р╕лр╕ер╕▒р╕Б */}
            {/* р╕зр╕Зр╕Бр╕ер╕бр╕кр╕╡р╕бр╣Ир╕зр╕Зр╕Чр╕╡р╣Ир╕бр╕╕р╕бр╕Вр╕зр╕▓р╕Ър╕Щ - р╣Ар╕Ыр╣Зр╕Щр╕нр╕Зр╕Др╣Мр╕Ыр╕гр╕░р╕Бр╕нр╕Ър╕Бр╕▓р╕гр╕Хр╕▒р╕Фр╣Бр╕Хр╣Ир╕З */}
            <div className="absolute -top-16 -right-16 w-35 h-35 bg-purple-500 rounded-full"></div>

            {/* р╕Ыр╕╕р╣Ир╕бр╕Ыр╕┤р╕Ф modal - р╕зр╕▓р╕Зр╣Др╕зр╣Йр╕Ър╕Щр╕зр╕Зр╕Бр╕ер╕бр╕кр╕╡р╕бр╣Ир╕зр╕З */}
            <button
              onClick={closePopup} // р╣Ар╕бр╕╖р╣Ир╕нр╕Др╕ер╕┤р╕Бр╣Гр╕лр╣Йр╕Ыр╕┤р╕Ф popup
              className="absolute top-2 right-2 z-10 text-white hover:text-gray-200 transition-colors" // р╕Ир╕▒р╕Фр╕Хр╕│р╣Бр╕лр╕Щр╣Ир╕Зр╣Бр╕ер╕░р╕кр╕╡
            >
              {/* р╣Др╕нр╕Др╕нр╕Щ X р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Ыр╕┤р╕Ф */}
              <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth="3">
                <path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>

            <div className="flex"> {/* Container р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Ир╕▒р╕Фр╣Ар╕гр╕╡р╕вр╕Зр╣Ар╕Щр╕╖р╣Йр╕нр╕лр╕▓р╣Гр╕Щр╣Бр╕Щр╕зр╕Щр╕нр╕Щ */}
              {/* р╕Юр╕╖р╣Йр╕Щр╕лр╕ер╕▒р╕Зр╕кр╕╡р╕бр╣Ир╕зр╕Зр╣Вр╕Др╣Йр╕Зр╕бр╕Щ - р╕нр╕Зр╕Др╣Мр╕Ыр╕гр╕░р╕Бр╕нр╕Ър╕Хр╕Бр╣Бр╕Хр╣Ир╕З */}
              <div className="absolute -bottom-50 right-120 w-100 h-100 bg-purple-500 rounded-full "></div>

              {/* р╕гр╕╣р╕Ыр╕ар╕▓р╕Юр╕Щр╕▒р╕Бр╣Ар╕гр╕╡р╕вр╕Щ */}
              <div className="absolute -bottom-2"> {/* р╕Ир╕▒р╕Фр╕Хр╕│р╣Бр╕лр╕Щр╣Ир╕Зр╕гр╕╣р╕Ыр╕ар╕▓р╕Ю */}
                <Image
                  src="/assets/images/person.png" // р╕Чр╕╡р╣Ир╕нр╕вр╕╣р╣Ир╣Др╕Яр╕ер╣Мр╕гр╕╣р╕Ыр╕ар╕▓р╕Ю
                  width={150} // р╕Др╕зр╕▓р╕бр╕Бр╕зр╣Йр╕▓р╕З
                  height={150} // р╕Др╕зр╕▓р╕бр╕кр╕╣р╕З
                  alt="Student thinking" // р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б alt р╕кр╕│р╕лр╕гр╕▒р╕Ъ accessibility
                  className="object-contain relative z-10" // CSS р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╣Бр╕кр╕Фр╕Зр╕Ьр╕е
                />
              </div>

              {/* р╕кр╣Ир╕зр╕Щр╕Вр╕зр╕▓ - р╕Яр╕нр╕гр╣Мр╕бр╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕гр╕нр╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕е */}
              <div className="w-1/2 p-8 flex flex-col justify-center ml-70"> {/* Container р╕Яр╕нр╕гр╣Мр╕б */}
                <div className="bg-white p-6 rounded-2xl shadow-lg"> {/* р╕Бр╕ер╣Ир╕нр╕Зр╕Яр╕нр╕гр╣Мр╕б */}
                  {/* р╕лр╕▒р╕зр╕Вр╣Йр╕нр╕Яр╕нр╕гр╣Мр╕б */}
                  <h2 className="text-purple-700 font-bold text-xl mb-6 flex items-center gap-2">
                    <span>ЁЯПа</span> р╕Кр╕╖р╣Ир╕нр╕Др╕ер╕▓р╕к {/* р╣Др╕нр╕Др╕нр╕Щ emoji р╣Бр╕ер╕░р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б */}
                  </h2>

                  {/* р╕Ыр╣Йр╕▓р╕вр╕Бр╕│р╕Бр╕▒р╕Ър╕кр╕│р╕лр╕гр╕▒р╕Ъ input field */}
                  <label className="block text-purple-600 text-sm mb-2">
                    р╕Кр╕╖р╣Ир╕нр╕Др╕ер╕▓р╕к
                  </label>

                  {/* р╕Кр╣Ир╕нр╕Зр╕Бр╕гр╕нр╕Бр╕Кр╕╖р╣Ир╕нр╕Др╕ер╕▓р╕к */}
                  <input
                    type="text" // р╕Ыр╕гр╕░р╣Ар╕ар╕Ч input
                    value={className} // р╕Др╣Ир╕▓р╕Чр╕╡р╣Ир╣Бр╕кр╕Фр╕Зр╣Гр╕Щ input (р╕Ир╕▓р╕Б state)
                    onChange={(e) => { // р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕Чр╕╡р╣Ир╕Чр╕│р╕Зр╕▓р╕Щр╣Ар╕бр╕╖р╣Ир╕нр╕бр╕╡р╕Бр╕▓р╕гр╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╣Бр╕Ыр╕ер╕Зр╕Др╣Ир╕▓
                      setClassName(e.target.value); // р╕нр╕▒р╕Ыр╣Ар╕Фр╕Х state р╕Кр╕╖р╣Ир╕нр╕Др╕ер╕▓р╕к
                      setError(null); // р╕ер╣Йр╕▓р╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Ар╕бр╕╖р╣Ир╕нр╕Бр╕гр╕нр╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Гр╕лр╕бр╣И
                    }}
                    placeholder="р╕Кр╕╖р╣Ир╕нр╕Др╕ер╕▓р╕к" // р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Бр╕кр╕Фр╕Зр╣Ар╕бр╕╖р╣Ир╕нр╕вр╕▒р╕Зр╣Др╕бр╣Ир╣Др╕Фр╣Йр╕Бр╕гр╕нр╕Б
                    className="w-full border-2 border-purple-200 rounded-4xl px-4 py-3 mb-6 focus:outline-none focus:border-purple-400" // CSS р╕кр╕│р╕лр╕гр╕▒р╕Ъ styling
                  />

                  {/* р╣Бр╕кр╕Фр╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Бр╕кр╕Фр╕Зр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Ф - р╣Бр╕кр╕Фр╕Зр╣Ар╕бр╕╖р╣Ир╕нр╕бр╕╡ error */}
                  {error && (
                    <div className="text-red-500 mb-4 text-sm">{error}</div>
                  )}

                  {/* р╕Ыр╕╕р╣Ир╕бр╕кр╕гр╣Йр╕▓р╕Зр╕Др╕ер╕▓р╕к */}
                  <div className="p-5"> {/* Container р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Ыр╕╕р╣Ир╕б */}
                    <button
                      onClick={handleCreateClass} // р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕Чр╕╡р╣Ир╣Ар╕гр╕╡р╕вр╕Бр╣Ар╕бр╕╖р╣Ир╕нр╕Др╕ер╕┤р╕Б
                      disabled={loading} // р╕Ыр╕┤р╕Фр╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╕Ыр╕╕р╣Ир╕бр╣Ар╕бр╕╖р╣Ир╕нр╕Бр╕│р╕ер╕▒р╕Зр╣Вр╕лр╕ер╕Ф
                      className="w-full bg-purple-500 text-white py-3 rounded-xl font-medium hover:bg-purple-600 transition-colors" // CSS styling
                    >
                      {loading ? "р╕Бр╕│р╕ер╕▒р╕Зр╕кр╕гр╣Йр╕▓р╕З..." : "р╕кр╕гр╣Йр╕▓р╕З"} {/* р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Ыр╕╕р╣Ир╕бр╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╕Хр╕▓р╕бр╕кр╕Цр╕▓р╕Щр╕░р╕Бр╕▓р╕гр╣Вр╕лр╕ер╕Ф */}
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* р╕лр╕Щр╣Йр╕▓р╕Ир╕нр╕кр╣Бр╕Бр╕Щ QR Code - р╣Бр╕кр╕Фр╕Зр╣Ар╕бр╕╖р╣Ир╕н scanning р╣Ар╕Ыр╣Зр╕Щ true */}
      {scanning && (
        <div className="fixed inset-0 bg-white flex flex-col items-center justify-center z-50"> {/* р╕лр╕Щр╣Йр╕▓р╕Ир╕нр╣Ар╕Хр╣Зр╕бр╕Ир╕нр╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕кр╣Бр╕Бр╕Щ */}
          <div className="relative"> {/* Container р╕кр╕│р╕лр╕гр╕▒р╕Ъ video р╣Бр╕ер╕░ canvas */}
            {/* Video element р╕кр╕│р╕лр╕гр╕▒р╕Ър╣Бр╕кр╕Фр╕Зр╕ар╕▓р╕Юр╕Ир╕▓р╕Бр╕Бр╕ер╣Йр╕нр╕З */}
            <video
              ref={videoRef} // р╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╕Бр╕▒р╕Ъ useRef
              autoPlay // р╣Ар╕ер╣Ир╕Щр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤
              playsInline // р╣Ар╕ер╣Ир╕Щр╣Бр╕Ър╕Ъ inline (р╕кр╕│р╕лр╕гр╕▒р╕Ър╕бр╕╖р╕нр╕Цр╕╖р╕н)
              style={{ width: '100%', maxWidth: '640px' }} // р╕Бр╕│р╕лр╕Щр╕Фр╕Вр╕Щр╕▓р╕Ф
            />

            {/* Canvas element р╕кр╕│р╕лр╕гр╕▒р╕Ър╕зр╕▓р╕Фр╕Бр╕гр╕нр╕Ър╕Бр╕▓р╕гр╕кр╣Бр╕Бр╕Щ */}
            <canvas
              ref={canvasRef} // р╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╕Бр╕▒р╕Ъ useRef
              style={{
                position: 'absolute', // р╕зр╕▓р╕Зр╕Чр╕▒р╕Ър╕Ър╕Щ video
                top: 0,
                left: 0,
                width: '100%',
                height: '100%'
              }}
            />
          </div>

          {/* р╕Ыр╕╕р╣Ир╕бр╕Ыр╕┤р╕Фр╕Бр╕▓р╕гр╕кр╣Бр╕Бр╕Щ */}
          <button
            className="absolute top-2 right-1 text-purple-500 hover:text-purple-700" // р╕Ир╕▒р╕Фр╕Хр╕│р╣Бр╕лр╕Щр╣Ир╕Зр╣Бр╕ер╕░р╕кр╕╡
            onClick={() => { // р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╣Ар╕бр╕╖р╣Ир╕нр╕Др╕ер╕┤р╕Бр╕Ыр╕┤р╕Ф
              setScanning(false); // р╕Ыр╕┤р╕Фр╕кр╕Цр╕▓р╕Щр╕░р╕Бр╕▓р╕гр╕кр╣Бр╕Бр╕Щ

              // р╕Цр╣Йр╕▓р╕бр╕╡ video stream р╕нр╕вр╕╣р╣Ир╣Гр╕лр╣Йр╕лр╕вр╕╕р╕Фр╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щ
              if (videoRef.current?.srcObject) {
                const stream = videoRef.current.srcObject as MediaStream; // р╣Бр╕Ыр╕ер╕Зр╣Ар╕Ыр╣Зр╕Щ MediaStream
                stopCamera(stream); // р╕лр╕вр╕╕р╕Фр╕Бр╕ер╣Йр╕нр╕З
                videoRef.current.srcObject = null; // р╕ер╣Йр╕▓р╕З video source
              }
            }}
          >
            <FaTimes size={40} /> {/* р╣Др╕нр╕Др╕нр╕Щр╕Ыр╕┤р╕Ф р╕Вр╕Щр╕▓р╕Ф 40px */}
          </button>
        </div>
      )}
    </div>
  )
};

// р╕кр╣Ир╕Зр╕нр╕нр╕Б Component р╣Ар╕Ыр╣Зр╕Щ default export
export default AddClassPopup;